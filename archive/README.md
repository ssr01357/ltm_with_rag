# Documentation

## Read Me First 
- Dataset for this project: `/secure/shared_data/tcga_path_reports/`
- Utilities
    - `src/prompts.py` contains prompt templates that will be used in 
        - `src/call_tgi_api.py` (zero-shot prompting) and 
        - `prepare-few-shots-formatted-prompts.ipynb` (dynamic report-length few-shots)
    - `src/metrics.py` contains performance calculation functions used in `evaluate.ipynb`
- Evaluation
    - `evaluate.ipynb` calculates the performance of inference results.
    - `analyze-ZSCOT-cancer-specific-patients.ipynb` exports ZS-COT results for cancer-specific patients.

## Zero-shot Prompting
- `calculate_tokens.ipynb` calculates number of tokens for reports and sorts the reports by tokens. This notebook exports the processed dataset you can use for the subsequent programs.
- `src/call_tgi_py` takes processed datasets as inputs, makes prompts for each report, asks a selected LLM to perform inference, and export the inference results.
    ```bash
    # for t14
    python src/call_tgi_api.py -m "m42-health/med42-70b" \
    -d "/home/cc3859/projects/rag-tnm/t14_test_dir/t14_4096_test.csv" \
    -p "zs" \
    -dec "greedy"

    # for n03
    python src/call_tgi_api.py -m "m42-health/med42-70b" \
    -d "/home/cc3859/projects/rag-tnm/n03_test_dir/n03_4096_all_test.csv" \
    -p "zs" -dec "greedy"

    # for m01
    python src/call_tgi_api.py -m "m42-health/med42-70b" \
    -d "/home/cc3859/projects/rag-tnm/m01_test_dir/m01_4096_all_test.csv" \
    -p "zs" -dec "greedy"
    ```
## Dynamic Report-length Few-shots (Only T category now)
- `select-report-length-few-shots.ipynb` embeds training and testing reports in Chroma.
- `prepare-few-shots-formatted-prompts.ipynb` prepares and outputs the formatted prompts with selected few-shots.
- `src/call_tgi_api_dfs.py` takes formatted prompts generated by previous notebook and perfoms the inference using the LLM.
    ```bash
    python src/call_tgi_api_dfs.py \
    -d "/secure/shared_data/rag_tnm_results/summary/formatted_for_dfs/formatted_brca_n03_noMention.csv" \
    -o "/secure/shared_data/rag_tnm_results/summary/result_dfs/formatted_brca_n03_noMention.csv" \
    -dec "greedy"
    ```

## Working (Unused)
- (Working) `load_reports_Chroma.ipynb` implemets RAG using re-ranking technique. This one shoule be modified later.